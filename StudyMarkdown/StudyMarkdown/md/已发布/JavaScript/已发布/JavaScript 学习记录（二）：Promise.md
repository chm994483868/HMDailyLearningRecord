# JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼ˆPromise å­¦ä¹ ï¼‰

&emsp;å¼‚æ­¥ï¼ˆAsynchronous, asyncï¼‰æ˜¯ä¸åŒæ­¥ï¼ˆSynchronous, syncï¼‰ç›¸å¯¹çš„æ¦‚å¿µã€‚

## å¼‚æ­¥æ¦‚å¿µ

&emsp;åœ¨ä¼ ç»Ÿå•çº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œç¨‹åºçš„è¿è¡Œæ˜¯åŒæ­¥çš„ï¼ˆåŒæ­¥ä¸æ„å‘³ç€æ‰€æœ‰æ­¥éª¤åŒæ—¶è¿è¡Œï¼Œè€Œæ˜¯æŒ‡æ­¥éª¤åœ¨ä¸€ä¸ªæ§åˆ¶æµåºåˆ—ä¸­æŒ‰é¡ºåºæ‰§è¡Œï¼‰ã€‚è€Œå¼‚æ­¥çš„æ¦‚å¿µåˆ™æ˜¯ä¸ä¿è¯åŒæ­¥çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹çš„æ‰§è¡Œå°†ä¸å†ä¸åŸæœ‰çš„åºåˆ—æœ‰é¡ºåºå…³ç³»ã€‚ç®€å•æ¥ç†è§£å°±æ˜¯ï¼šåŒæ­¥æŒ‰ä»£ç é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥ä¸æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚(ä¸€ä¸ªæ˜¯æ¥åŠ›èµ›ï¼Œä¸€ä¸ªæ˜¯çŸ­è·‘èµ›)

&emsp;ä»¥ä¸Šæ˜¯å…³äºå¼‚æ­¥çš„æ¦‚å¿µçš„è§£é‡Šï¼Œé€šä¿—åœ°è§£é‡Šä¸€ä¸‹å¼‚æ­¥ï¼šå¼‚æ­¥å°±æ˜¯ä»ä¸»çº¿ç¨‹å‘å°„ä¸€ä¸ªå­çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ã€‚

## éœ€è¦å¼‚æ­¥ç¼–ç¨‹çš„åœºæ™¯ 

&emsp;æˆ‘ä»¬å¸¸å¸¸ç”¨å­çº¿ç¨‹æ¥å®Œæˆä¸€äº›å¯èƒ½æ¶ˆè€—æ—¶é—´è¶³å¤Ÿé•¿ä»¥è‡³äºè¢«ç”¨æˆ·å¯Ÿè§‰çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æˆ–è€…å‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚å› ä¸ºå­çº¿ç¨‹ç‹¬ç«‹äºä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥å³ä½¿å‡ºç°é˜»å¡ä¹Ÿä¸ä¼šå½±å“ä¸»çº¿ç¨‹çš„è¿è¡Œã€‚ä½†æ˜¯å­çº¿ç¨‹æœ‰ä¸€ä¸ªå±€é™ï¼šä¸€æ—¦å‘å°„äº†ä»¥åå°±ä¼šä¸ä¸»çº¿ç¨‹å¤±å»åŒæ­¥ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šå®ƒçš„ç»“æŸï¼Œå¦‚æœç»“æŸä¹‹åéœ€è¦å¤„ç†ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•å°†å®ƒåˆå¹¶åˆ°ä¸»çº¿ç¨‹ä¸­å»çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaScript ä¸­çš„å¼‚æ­¥æ“ä½œå‡½æ•°å¾€å¾€é€šè¿‡å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ä»»åŠ¡çš„ç»“æœå¤„ç†ã€‚

## å›è°ƒå‡½æ•°

&emsp;ä¸‹é¢ç¤ºä¾‹ç¨‹åºä¸­çš„ `setTimeout` å°±æ˜¯ä¸€ä¸ªæ¶ˆè€—æ—¶é—´è¾ƒé•¿ï¼ˆ3 ç§’ï¼‰çš„è¿‡ç¨‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¯«ç§’æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªå­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¼šç­‰å¾… 3 ç§’ï¼Œç„¶åæ‰§è¡Œå›è°ƒå‡½æ•° `print`ã€‚

```c++
function print() {
    document.getElementById("demo").innerHTML = "SUCCESS!";
}
setTimeout(print, 3000);
console.log("TEST");

// å¦ä¸€ç§å†™æ³•ï¼š
setTimeout(function () {
    document.getElementById("demo").innerHTML = "SUCCESS!";
}, 3000);
console.log("TEST");
```

&emsp;`setTimeout` ä¼šåœ¨å­çº¿ç¨‹ä¸­ç­‰å¾… 3 ç§’ï¼Œåœ¨ `setTimeout` å‡½æ•°æ‰§è¡Œä¹‹åä¸»çº¿ç¨‹å¹¶æ²¡æœ‰åœæ­¢ã€‚

## JavaScript Promise

&emsp;Promise æ˜¯ä¸€ä¸ª ECMAScript 6 æä¾›çš„ç±»ï¼Œç›®çš„æ˜¯æ›´åŠ ä¼˜é›…åœ°ä¹¦å†™å¤æ‚çš„å¼‚æ­¥ä»»åŠ¡ã€‚ç”±äº Promise æ˜¯ ES6 æ–°å¢åŠ çš„ï¼Œæ‰€ä»¥ä¸€äº›æ—§çš„æµè§ˆå™¨å¹¶ä¸æ”¯æŒï¼Œè‹¹æœçš„ Safari 10 å’Œ Windows çš„ Edge 14 ç‰ˆæœ¬ä»¥ä¸Šæµè§ˆå™¨æ‰å¼€å§‹æ”¯æŒ ES6 ç‰¹æ€§ã€‚

### æ„é€  Promise å¯¹è±¡

&emsp;æ–°å»ºä¸€ä¸ª Promise å¯¹è±¡ï¼š

```c++
new Promise(function (resolve, reject) {
    // è¦åšçš„äº‹æƒ…...
});
```

&emsp;é€šè¿‡æ–°å»ºä¸€ä¸ª Promise å¯¹è±¡å¥½åƒå¹¶æ²¡æœ‰çœ‹å‡ºå®ƒæ€æ · "æ›´åŠ ä¼˜é›…åœ°ä¹¦å†™å¤æ‚çš„å¼‚æ­¥ä»»åŠ¡"ã€‚æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„å¼‚æ­¥ä»»åŠ¡éƒ½æ˜¯ä¸€æ¬¡å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦å¤šæ¬¡è°ƒç”¨å¼‚æ­¥å‡½æ•°å‘¢ï¼Ÿä¾‹å¦‚ï¼Œå¦‚æœåˆ†ä¸‰æ¬¡è¾“å‡ºå­—ç¬¦ä¸²ï¼Œç¬¬ä¸€æ¬¡é—´éš” 1 ç§’ï¼Œç¬¬äºŒæ¬¡é—´éš” 4 ç§’ï¼Œç¬¬ä¸‰æ¬¡é—´éš” 3 ç§’ï¼š

```c++
// é¦–å…ˆ 1 ç§’åè¾“å‡º First
setTimeout(function () {
    console.log("First");
    
    // ç„¶å 4 ç§’åè¾“å‡º Second
    setTimeout(function () {
        console.log("Second");
        
        // æœ€å 3 ç§’åè¾“å‡º Third 
        setTimeout(function () {
            console.log("Third");
        }, 3000);
    }, 4000); 
}, 1000);
```

&emsp;è¿™æ®µç¨‹åºå®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨ "å‡½æ•°ç€‘å¸ƒ" æ¥å®ç°çš„ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œåœ¨ä¸€ä¸ªå¤æ‚çš„ç¨‹åºå½“ä¸­ï¼Œç”¨ "å‡½æ•°ç€‘å¸ƒ" å®ç°çš„ç¨‹åºæ— è®ºæ˜¯ç»´æŠ¤è¿˜æ˜¯å¼‚å¸¸å¤„ç†éƒ½æ˜¯ä¸€ä»¶ç‰¹åˆ«ç¹ççš„äº‹æƒ…ï¼Œè€Œä¸”ä¼šè®©ç¼©è¿›æ ¼å¼å˜å¾—éå¸¸å†—èµ˜ã€‚

&emsp;ç°åœ¨ç”¨ Promise æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ï¼š

```c++
new Promise(function (resolve, reject) {
    
    // é¦–å…ˆ 1 ç§’åè¾“å‡º First
    setTimeout(function () {
        console.log("First");
        
        // è¿™é‡Œè°ƒç”¨äº† resolve
        resolve();
    }, 1000);
    
}).then(function () {

    // ç„¶å 4 ç§’åè¾“å‡º Secondï¼Œè¿™é‡Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡
    return new Promise(function (resolve, reject) {
    
        setTimeout(function () {
            console.log("Second");
            
            // è¿™é‡Œè°ƒç”¨äº† resolve
            resolve();
        }, 4000);
    });    
}).then(function () {
    
    // æœ€å 3 ç§’åè¾“å‡º Third 
    setTimeout(function () {
        console.log("Third");
    }, 3000);
});
```

&emsp;ä¸Šé¢ç¤ºä¾‹ä»£ç è¾ƒé•¿ï¼Œå¯ä»¥ä¸‹ä¸ç”¨ç†è§£å®ƒï¼Œä¸‹é¢ä¼šå¯¹å®ƒè¿›è¡Œåˆ†æï¼Œé‡ç‚¹æˆ‘ä»¬å…³æ³¨åœ¨ï¼šPromise å°†åµŒå¥—æ ¼å¼çš„ä»£ç å˜æˆäº†é¡ºåºæ ¼å¼çš„ä»£ç ã€‚

### Promise çš„ä½¿ç”¨

&emsp;Promise æ„é€ å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ„é€ ä¹‹åä¼šç›´æ¥è¢«å¼‚æ­¥è¿è¡Œï¼Œæ‰€ä»¥ç§°ä¹‹ä¸º **èµ·å§‹å‡½æ•°**ã€‚**èµ·å§‹å‡½æ•°** åŒ…å«ä¸¤ä¸ªå‚æ•° `resolve` å’Œ `reject`ã€‚

&emsp;å½“ Promise è¢«æ„é€ æ—¶ï¼Œèµ·å§‹å‡½æ•°ä¼šè¢«å¼‚æ­¥æ‰§è¡Œï¼š

```c++
new Promise(function (resolve, reject) {
    console.log("Run");
});
```

&emsp;è¿™æ®µç¨‹åºä¼šç›´æ¥è¾“å‡º Runã€‚`resolve` å’Œ `reject` éƒ½æ˜¯å‡½æ•°ï¼Œå…¶ä¸­è°ƒç”¨ `resolve` ä»£è¡¨ä¸€åˆ‡æ­£å¸¸ï¼Œ`reject` æ˜¯å‡ºç°å¼‚å¸¸æ—¶æ‰€è°ƒç”¨çš„ï¼š

```c++
new Promise(function (resolve, reject) {
    var a = 0;
    var b = 1;
    
    if (b == 0) reject("Divide zero");
    else resolve(a / b);
}).then(function (value) {
    console.log("a / b = " + value);
}).catch(function (err) {
    console.log(err);
}).finally(function () {
    console.log("End");
});

// è¾“å‡º
a / b = 0
End
```

&emsp;Promise ç±»æœ‰ `.then()`ã€`.catch()` å’Œ `.finally()` ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ`.then()` å¯ä»¥å°†å‚æ•°ä¸­çš„å‡½æ•°æ·»åŠ åˆ°å½“å‰ Promise çš„æ­£å¸¸æ‰§è¡Œåºåˆ—ï¼Œ`.catch()` åˆ™æ˜¯è®¾å®š Promise çš„å¼‚å¸¸å¤„ç†åºåˆ—ï¼Œ`.finally()` æ˜¯åœ¨ Promise æ‰§è¡Œçš„æœ€åä¸€å®šä¼šæ‰§è¡Œçš„åºåˆ—ã€‚`.then()` ä¼ å…¥çš„å‡½æ•°ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæœ‰ä»»ä½•å¼‚å¸¸éƒ½ä¼šç›´æ¥è·³åˆ° `catch` åºåˆ—ï¼š

```c++
new Promise(function (resolve, reject) {
    // è¿™é‡Œè¾“å‡º 1111
    console.log(1111);
    
    // è¿™é‡ŒæŠŠ 2222 ä½œä¸ºå‚æ•°ä¼ å…¥ä¸‹é¢çš„ then å‚æ•°ä¸­çš„å‡½æ•°åšå‚æ•°ï¼Œ
    // è¿™é‡Œå¦‚æœä¸è°ƒç”¨ resolve åˆ™å‡½æ•°å°±ä¸ä¼šå‘ä¸‹æ‰§è¡Œäº†
    resolve(2222);
    console.log("resolve æ‰§è¡Œäº†ï¼Œè¿™é‡Œä¾ç„¶ä¼šæ‰§è¡Œï¼Œä¸è¦æŠŠ resolve å½“ä½œ return çœ‹å¾…")
}).then(function (value) {
    // è¿™é‡Œè¾“å‡ºä¸Šé¢ä¼ æ¥çš„ 2222
    console.log(value);
    
    // è¿™é‡ŒæŠŠ 3333 ä¼ å…¥ä¸‹é¢çš„ tnenï¼Œè¿™é‡Œå’Œä¸Šé¢ä¸åŒï¼Œä¸Šé¢ä½¿ç”¨çš„ resolve æ‰§è¡Œï¼Œè¿™é‡Œåˆ™æ˜¯ä½¿ç”¨ return è¿”å› 
    return 3333;
}).then(function (value) {
    // è¿™é‡Œè¾“å‡º 3333
    console.log(value);
    
    // è¿™é‡ŒæŠ›å‡ºä¸€ä¸ª error
    throw "An error";
}).catch(function (err) {
    // è¿™é‡Œ catch æ•è·åˆ°ä¸Šé¢æŠ›å‡ºçš„ error
    console.log(err);
});

// è¾“å‡º
1111
resolve æ‰§è¡Œäº†ï¼Œè¿™é‡Œä¾ç„¶ä¼šæ‰§è¡Œï¼Œä¸è¦æŠŠ resolve å½“ä½œ return çœ‹å¾…
2222
3333
An error
```

&emsp;`resolve()` ä¸­å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸‹ä¸€ä¸ª `then` ä¼ é€’ä¸€ä¸ªå€¼ï¼Œ`then` ä¸­çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå€¼ä¼ é€’ç»™ `then`ã€‚ä½†æ˜¯ï¼Œå¦‚æœ `then` ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ª `then` å°†ç›¸å½“äºå¯¹è¿™ä¸ªè¿”å›çš„ Promise è¿›è¡Œæ“ä½œï¼Œè¿™ä¸€ç‚¹ä»åˆšæ‰çš„è®¡æ—¶å™¨çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºæ¥ã€‚`reject()` å‚æ•°ä¸­ä¸€èˆ¬ä¼šä¼ é€’ä¸€ä¸ªå¼‚å¸¸ç»™ä¹‹åçš„ `catch` å‡½æ•°ç”¨äºå¤„ç†å¼‚å¸¸ã€‚

&emsp;ä½†æ˜¯è¯·æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š

+ `resolve` å’Œ `reject` çš„ä½œç”¨åŸŸåªæœ‰èµ·å§‹å‡½æ•°ï¼Œä¸åŒ…æ‹¬ `then` ä»¥åŠå…¶ä»–åºåˆ—ï¼›
+ `resolve` å’Œ `reject` å¹¶ä¸èƒ½å¤Ÿä½¿èµ·å§‹å‡½æ•°åœæ­¢è¿è¡Œï¼Œåˆ«å¿˜äº† `return`ã€‚

### Promise å‡½æ•°

&emsp;ä¸Šè¿°ä½¿ç”¨ Promise çš„ "è®¡æ—¶å™¨" ç¨‹åºçœ‹ä¸Šå»æ¯”å‡½æ•°ç€‘å¸ƒè¿˜è¦é•¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒçš„æ ¸å¿ƒéƒ¨åˆ†å†™æˆä¸€ä¸ª Promise å‡½æ•°ï¼š

```c++
function print(delay, message) {
    return new Promise(function (resolve, reject) {
        setTimeout(function () {
            console.log(message);
            resolve();
        }, delay);
    });
}
```

&emsp;ç„¶åå°±å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å®ç°ç¨‹åºåŠŸèƒ½äº†ï¼š

```c++
print(1000, "First").then(function () {
    return print(4000, "Second");
}).then(function () {
    print(3000, "Third");
});
```

&emsp;è¿™ç§è¿”å›å€¼ä¸ºä¸€ä¸ª Promise å¯¹è±¡çš„å‡½æ•°ç§°ä½œ Promise å‡½æ•°ï¼Œå®ƒå¸¸å¸¸ç”¨äºå¼€å‘åŸºäºå¼‚æ­¥æ“ä½œçš„åº“ã€‚


### å›ç­”å¸¸è§çš„é—®é¢˜ï¼ˆFAQï¼‰

&emsp;Q: thenã€catch å’Œ finally åºåˆ—èƒ½å¦é¡ºåºé¢ å€’ï¼Ÿ
&emsp;A: å¯ä»¥ï¼Œæ•ˆæœå®Œå…¨ä¸€æ ·ã€‚ä½†ä¸å»ºè®®è¿™æ ·åšï¼Œæœ€å¥½æŒ‰ then-catch-finally çš„é¡ºåºç¼–å†™ç¨‹åºã€‚

&emsp;Q: é™¤äº† then å—ä»¥å¤–ï¼Œå…¶å®ƒä¸¤ç§å—èƒ½å¦å¤šæ¬¡ä½¿ç”¨ï¼Ÿ
&emsp;A: å¯ä»¥ï¼Œfinally ä¸ then ä¸€æ ·ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œä½†æ˜¯ catch å—åªä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªï¼Œé™¤é catch å—é‡Œæœ‰å¼‚å¸¸ã€‚æ‰€ä»¥æœ€å¥½åªå®‰æ’ä¸€ä¸ª catch å’Œ finally å—ã€‚

&emsp;Q: then å—å¦‚ä½•ä¸­æ–­ï¼Ÿ
&emsp;A: then å—é»˜è®¤ä¼šå‘ä¸‹é¡ºåºæ‰§è¡Œï¼Œreturn æ˜¯ä¸èƒ½ä¸­æ–­çš„ï¼Œå¯ä»¥é€šè¿‡ throw æ¥è·³è½¬è‡³ catch å®ç°ä¸­æ–­ã€‚

&emsp;Q: ä»€ä¹ˆæ—¶å€™é€‚åˆç”¨ Promise è€Œä¸æ˜¯ä¼ ç»Ÿå›è°ƒå‡½æ•°ï¼Ÿ
&emsp;A: å½“éœ€è¦å¤šæ¬¡é¡ºåºæ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæƒ³é€šè¿‡å¼‚æ­¥æ–¹æ³•å…ˆåæ£€æµ‹ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦å…ˆå¼‚æ­¥æ£€æµ‹ç”¨æˆ·åï¼Œç„¶åå†å¼‚æ­¥æ£€æµ‹å¯†ç çš„æƒ…å†µä¸‹å°±å¾ˆé€‚åˆ Promiseã€‚

&emsp;Q: Promise æ˜¯ä¸€ç§å°†å¼‚æ­¥è½¬æ¢ä¸ºåŒæ­¥çš„æ–¹æ³•å—ï¼Ÿ
&emsp;A: å®Œå…¨ä¸æ˜¯ã€‚Promise åªä¸è¿‡æ˜¯ä¸€ç§æ›´è‰¯å¥½çš„ç¼–ç¨‹é£æ ¼ã€‚

&emsp;Q: ä»€ä¹ˆæ—¶å€™æˆ‘ä»¬éœ€è¦å†å†™ä¸€ä¸ª then è€Œä¸æ˜¯åœ¨å½“å‰çš„ then æ¥ç€ç¼–ç¨‹ï¼Ÿ
&emsp;A: å½“ä½ åˆéœ€è¦è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™ã€‚

### å¼‚æ­¥å‡½æ•°

&emsp;å¼‚æ­¥å‡½æ•°ï¼ˆasync functionï¼‰æ˜¯ ECMAScript 2017 (ECMA-262) æ ‡å‡†çš„è§„èŒƒï¼Œå‡ ä¹è¢«æ‰€æœ‰æµè§ˆå™¨æ‰€æ”¯æŒï¼Œé™¤äº† Internet Explorerã€‚

&emsp;åœ¨ Promise ä¸­æˆ‘ä»¬ç¼–å†™è¿‡ä¸€ä¸ª Promise å‡½æ•°ï¼š

```c++
function print(delay, message) {

    return new Promise(function (resolve, reject) {
        setTimeout(function () {
            console.log(message);
            resolve();
        }, delay);
    });
}
```

&emsp;ç„¶åç”¨ä¸åŒçš„æ—¶é—´é—´éš”è¾“å‡ºäº†ä¸‰è¡Œæ–‡æœ¬ï¼š

```c++
print(1000, "First").then(function () {
    return print(4000, "Second");
}).then(function () {
    print(3000, "Third");
});
```

&emsp;ä½¿ç”¨ **å¼‚æ­¥å‡½æ•°ï¼ˆ`async function`ï¼‰** å¯ä»¥å°†è¿™æ®µä»£ç å˜å¾—æ›´å¥½çœ‹ï¼š

```c++
async function asyncFunc() {
    await print(1000, "First");
    await print(4000, "Second");
    await print(3000, "Third");
}
asyncFunc();
```

&emsp;è¿™å²‚ä¸æ˜¯å°†å¼‚æ­¥æ“ä½œå˜å¾—åƒåŒæ­¥æ“ä½œä¸€æ ·å®¹æ˜“äº†å—ï¼è¿™æ¬¡çš„å›ç­”æ˜¯è‚¯å®šçš„ï¼Œå¼‚æ­¥å‡½æ•° `async function` ä¸­å¯ä»¥ä½¿ç”¨ `await` æŒ‡ä»¤ï¼Œ`await` æŒ‡ä»¤åå¿…é¡»è·Ÿç€ä¸€ä¸ª Promiseï¼Œå¼‚æ­¥å‡½æ•°ä¼šåœ¨è¿™ä¸ª Promise è¿è¡Œä¸­æš‚åœï¼Œç›´åˆ°å…¶è¿è¡Œç»“æŸå†ç»§ç»­è¿è¡Œã€‚å¼‚æ­¥å‡½æ•°å®é™…ä¸ŠåŸç†ä¸ Promise åŸç”Ÿ API çš„æœºåˆ¶æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ›´ä¾¿äºç¨‹åºå‘˜é˜…è¯»ã€‚

&emsp;å¤„ç†å¼‚å¸¸çš„æœºåˆ¶å°†ç”¨ `try-catch` å—å®ç°ï¼š

```c++
async function asyncFunc() {
    try {
        await new Promise(function (resolve, reject) {
            throw "Some error"; // æˆ–è€… reject("Some error")
        });
    } catch (err) {
        console.log(err);
        // ä¼šè¾“å‡º Some error
    }
}
asyncFunc();
```

&emsp;å¦‚æœ Promise æœ‰ä¸€ä¸ªæ­£å¸¸çš„è¿”å›å€¼ï¼Œ`await` è¯­å¥ä¹Ÿä¼šè¿”å›å®ƒï¼š

```c++
async function asyncFunc() {
    let value = await new Promise(
        function (resolve, reject) {
            resolve("Return value");
        }
    );
    console.log(value);
}
asyncFunc();
// è¾“å‡º
Return value
```

&emsp;Promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼šPendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€Resolvedï¼ˆå·²å®Œæˆï¼Œåˆç§° Fulfilledï¼‰å’Œ Rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚é€šè¿‡å›è°ƒé‡Œçš„ resolve(data) å°†è¿™ä¸ª promise æ ‡è®°ä¸º resolverdï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥ then((data)=>{ // do something })ï¼Œ`resolve` é‡Œçš„å‚æ•°å°±æ˜¯è¦ä¼ å…¥ `then` çš„æ•°æ®ã€‚

&emsp;ECMAscript 6 åŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise å¯¹è±¡ä»£è¡¨äº†æœªæ¥å°†è¦å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”¨æ¥ä¼ é€’å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚

### Promise å¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹

1. å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š

+ pending: åˆå§‹çŠ¶æ€ï¼Œä¸æ˜¯æˆåŠŸæˆ–å¤±è´¥çŠ¶æ€ã€‚
+ fulfilled: æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚
+ rejected: æ„å‘³ç€æ“ä½œå¤±è´¥ã€‚

&emsp;åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯ Promise è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯ã€Œæ‰¿è¯ºã€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚

2. ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚Promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä» Pending å˜ä¸º Resolved å’Œä» Pending å˜ä¸º Rejectedã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœã€‚å°±ç®—æ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹ Promise å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚

### Promise ä¼˜ç¼ºç‚¹

&emsp;æœ‰äº† Promise å¯¹è±¡ï¼Œå°±å¯ä»¥å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ã€‚æ­¤å¤–ï¼ŒPromise å¯¹è±¡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—æ§åˆ¶å¼‚æ­¥æ“ä½œæ›´åŠ å®¹æ˜“ã€‚

&emsp;Promise ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚é¦–å…ˆï¼Œæ— æ³•å–æ¶ˆ Promiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚å…¶æ¬¡ï¼Œå¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚ç¬¬ä¸‰ï¼Œå½“å¤„äº Pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚

### Promise åˆ›å»º

&emsp;è¦æƒ³åˆ›å»ºä¸€ä¸ª promise å¯¹è±¡ã€å¯ä»¥ä½¿ç”¨ `new` æ¥è°ƒç”¨ Promise çš„æ„é€ å™¨æ¥è¿›è¡Œå®ä¾‹åŒ–ã€‚

&emsp;ä¸‹é¢æ˜¯åˆ›å»º promise çš„æ­¥éª¤ï¼š

```c++
var promise = new Promise(function(resolve, reject) {
    // å¼‚æ­¥å¤„ç†
    // å¤„ç†ç»“æŸåã€è°ƒç”¨resolve æˆ– reject
});
```

&emsp;Promise æ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªå¸¦æœ‰ `resolveï¼ˆè§£æï¼‰` å’Œ `rejectï¼ˆæ‹’ç»ï¼‰` ä¸¤ä¸ªå‚æ•°çš„å›è°ƒã€‚åœ¨å›è°ƒä¸­æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆä¾‹å¦‚å¼‚æ­¥ï¼‰ï¼Œå¦‚æœä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåˆ™è°ƒç”¨ `resolve`ï¼Œå¦åˆ™è°ƒç”¨ `reject`ã€‚

```c++
var myFirstPromise = new Promise(function(resolve, reject){
    // å½“å¼‚æ­¥ä»£ç æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰ä¼šè°ƒç”¨ resolve(...)ï¼Œå½“å¼‚æ­¥ä»£ç å¤±è´¥æ—¶å°±ä¼šè°ƒç”¨ reject(...)
    // åœ¨æœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨ setTimeout(...) æ¥æ¨¡æ‹Ÿå¼‚æ­¥ä»£ç ï¼Œå®é™…ç¼–ç æ—¶å¯èƒ½æ˜¯ XHR è¯·æ±‚æˆ–æ˜¯ HTML5 çš„ä¸€äº› API æ–¹æ³•
    setTimeout(function(){
        resolve("æˆåŠŸ!"); // ä»£ç æ­£å¸¸æ‰§è¡Œï¼
    }, 250);
});
 
myFirstPromise.then(function(successMessage){
    // successMessage çš„å€¼æ˜¯ä¸Šé¢è°ƒç”¨ resolve(...) æ–¹æ³•ä¼ å…¥çš„å€¼.
    // successMessage å‚æ•°ä¸ä¸€å®šéè¦æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­
    document.write("Yay! " + successMessage);
});
```

&emsp;å¯¹äºå·²ç»å®ä¾‹åŒ–è¿‡çš„ `promise` å¯¹è±¡å¯ä»¥è°ƒç”¨ `promise.then()` æ–¹æ³•ï¼Œä¼ é€’ `resolve` å’Œ `reject` æ–¹æ³•ä½œä¸ºå›è°ƒã€‚

&emsp;`promise.then()` æ˜¯ `promise` æœ€ä¸ºå¸¸ç”¨çš„æ–¹æ³•ã€‚

```c++
promise.then(onFulfilled, onRejected)
```

&emsp;`promise` ç®€åŒ–äº†å¯¹ error çš„å¤„ç†ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š

```c++
promise.then(onFulfilled).catch(onRejected)
```

## Promise AJAX

&emsp;ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨ Promise å¯¹è±¡å®ç°çš„ AJAX æ“ä½œçš„ä¾‹å­ã€‚

```
function ajax(URL) {
    return new Promise(function (resolve, reject) {
        var req = new XMLHttpRequest(); 
        req.open('GET', URL, true);
        req.onload = function () {
        if (req.status === 200) { 
                resolve(req.responseText);
            } else {
                reject(new Error(req.statusText));
            } 
        };
        req.onerror = function () {
            reject(new Error(req.statusText));
        };
        req.send(); 
    });
}
var URL = "/try/ajax/testpromise.php"; 
ajax(URL).then(function onFulfilled(value){
    document.write('å†…å®¹æ˜¯ï¼š' + value); 
}).catch(function onRejected(error){
    document.write('é”™è¯¯ï¼š' + error); 
});
```

&emsp;ä¸Šé¢ä»£ç ä¸­ï¼Œ`resolve` æ–¹æ³•å’Œ `reject` æ–¹æ³•è°ƒç”¨æ—¶ï¼Œéƒ½å¸¦æœ‰å‚æ•°ã€‚å®ƒä»¬çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚`reject` æ–¹æ³•çš„å‚æ•°é€šå¸¸æ˜¯ Error å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œ `resolve` æ–¹æ³•çš„å‚æ•°é™¤äº†æ­£å¸¸çš„å€¼ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ˜¯å¦ä¸€ä¸ª Promise å®ä¾‹ï¼Œæ¯”å¦‚åƒä¸‹é¢è¿™æ ·ã€‚

```c++
var p1 = new Promise(function(resolve, reject){
  // ... some code
});
 
var p2 = new Promise(function(resolve, reject){
  // ... some code
  resolve(p1);
})
```

&emsp;ä¸Šé¢ä»£ç ä¸­ï¼Œp1 å’Œ p2 éƒ½æ˜¯ Promise çš„å®ä¾‹ï¼Œä½†æ˜¯ p2 çš„ `resolve` æ–¹æ³•å°† p1 ä½œä¸ºå‚æ•°ï¼Œè¿™æ—¶ p1 çš„çŠ¶æ€å°±ä¼šä¼ é€’ç»™ p2ã€‚å¦‚æœè°ƒç”¨çš„æ—¶å€™ï¼Œp1 çš„çŠ¶æ€æ˜¯ pendingï¼Œé‚£ä¹ˆ p2 çš„å›è°ƒå‡½æ•°å°±ä¼šç­‰å¾… p1 çš„çŠ¶æ€æ”¹å˜ï¼›å¦‚æœ p1 çš„çŠ¶æ€å·²ç»æ˜¯ fulfilled æˆ–è€… rejectedï¼Œé‚£ä¹ˆ p2 çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹åˆ»æ‰§è¡Œã€‚

## Promise.prototype.then æ–¹æ³•ï¼šé“¾å¼æ“ä½œ

&emsp;`Promise.prototype.then` æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ã€‚

```c++
getJSON("/posts.json").then(function(json) {
  return json.post;
}).then(function(post) {
  // proceed
});
```

&emsp;ä¸Šé¢çš„ä»£ç ä½¿ç”¨ `then` æ–¹æ³•ï¼Œä¾æ¬¡æŒ‡å®šäº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å®Œæˆä»¥åï¼Œä¼šå°†è¿”å›ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚å¦‚æœå‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ—¶åä¸€ä¸ªå›è°ƒå‡½æ•°å°±ä¼šç­‰å¾…è¯¥ Promise å¯¹è±¡æœ‰äº†è¿è¡Œç»“æœï¼Œæ‰ä¼šè¿›ä¸€æ­¥è°ƒç”¨ã€‚

```c++
getJSON("/post/1.json").then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // å¯¹ comments è¿›è¡Œå¤„ç†
});
```

&emsp;è¿™ç§è®¾è®¡ä½¿å¾—åµŒå¥—çš„å¼‚æ­¥æ“ä½œï¼Œå¯ä»¥è¢«å¾ˆå®¹æ˜“å¾—æ”¹å†™ï¼Œä»å›è°ƒå‡½æ•°çš„ "æ¨ªå‘å‘å±•" æ”¹ä¸º "å‘ä¸‹å‘å±•"ã€‚

## Promise.prototype.catch æ–¹æ³•ï¼šæ•æ‰é”™è¯¯

&emsp;`Promise.prototype.catch` æ–¹æ³•æ˜¯ `Promise.prototype.then(null, rejection)` çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚

```c++
getJSON("/posts.json").then(function(posts) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
  console.log('å‘ç”Ÿé”™è¯¯ï¼', error);
});
```

&emsp;Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰ "å†’æ³¡" æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª `catch` è¯­å¥æ•è·ã€‚

```c++
getJSON("/post/1.json").then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰ä¸¤ä¸ªå›è°ƒå‡½æ•°çš„é”™è¯¯
});
```

## Promise.all æ–¹æ³•ï¼ŒPromise.race æ–¹æ³•
&emsp;`Promise.all` æ–¹æ³•ç”¨äºå°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚

```c++
var p = Promise.all([p1,p2,p3]);
```

&emsp;ä¸Šé¢ä»£ç ä¸­ï¼Œ`Promise.all` æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1ã€p2ã€p3 éƒ½æ˜¯ Promise å¯¹è±¡çš„å®ä¾‹ã€‚ï¼ˆ`Promise.all` æ–¹æ³•çš„å‚æ•°ä¸ä¸€å®šæ˜¯æ•°ç»„ï¼Œä½†æ˜¯å¿…é¡»å…·æœ‰ `iterator` æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚ï¼‰

&emsp;`p` çš„çŠ¶æ€ç”± `p1`ã€`p2`ã€`p3` å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚

1. åªæœ‰ `p1`ã€`p2`ã€`p3` çš„çŠ¶æ€éƒ½å˜æˆ fulfilledï¼Œ`p` çš„çŠ¶æ€æ‰ä¼šå˜æˆ fulfilledï¼Œæ­¤æ—¶ `p1`ã€`p2`ã€`p3` çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™ `p` çš„å›è°ƒå‡½æ•°ã€‚
2. åªè¦ `p1`ã€`p2`ã€`p3` ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢« rejectedï¼Œ`p` çš„çŠ¶æ€å°±å˜æˆ rejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢« reject çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°ã€‚

&emsp;ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚

```c++
// ç”Ÿæˆä¸€ä¸ª Promise å¯¹è±¡çš„æ•°ç»„
var promises = [2, 3, 5, 7, 11, 13].map(function(id){
  return getJSON("/post/" + id + ".json");
});
 
Promise.all(promises).then(function(posts) {
  // ...  
}).catch(function(reason){
  // ...
});
```

&emsp;`Promise.race` æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚

```c++
var p = Promise.race([p1,p2,p3]);
```

&emsp;ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦ `p1`ã€`p2`ã€`p3` ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ`p` çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™ `p` çš„è¿”å›å€¼ã€‚

&emsp;å¦‚æœ `Promise.all` æ–¹æ³•å’Œ `Promise.race` æ–¹æ³•çš„å‚æ•°ï¼Œä¸æ˜¯ Promise å®ä¾‹ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„ `Promise.resolve` æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚

## Promise.resolve æ–¹æ³•ï¼ŒPromise.reject æ–¹æ³•

&emsp;æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œ`Promise.resolve` æ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚

```c++
var jsPromise = Promise.resolve($.ajax('/whatever.json'));
```

&emsp;ä¸Šé¢ä»£ç å°† jQuery ç”Ÿæˆ deferred å¯¹è±¡ï¼Œè½¬ä¸ºä¸€ä¸ªæ–°çš„ ES6 çš„ Promise å¯¹è±¡ã€‚

&emsp;å¦‚æœ `Promise.resolve` æ–¹æ³•çš„å‚æ•°ï¼Œä¸æ˜¯å…·æœ‰ `then` æ–¹æ³•çš„å¯¹è±¡ï¼ˆåˆç§° `thenable` å¯¹è±¡ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œä¸”å®ƒçš„çŠ¶æ€ä¸º fulfilledã€‚

```c++
var p = Promise.resolve('Hello');
 
p.then(function (s){
  console.log(s)
});
// Hello
```

&emsp;ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡çš„å®ä¾‹ `p`ï¼Œå®ƒçš„çŠ¶æ€ä¸º fulfilledï¼Œæ‰€ä»¥å›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œï¼Œ`Promise.resolve` æ–¹æ³•çš„å‚æ•°å°±æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚

&emsp;å¦‚æœ `Promise.resolve` æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª Promise å¯¹è±¡çš„å®ä¾‹ï¼Œåˆ™ä¼šè¢«åŸå°ä¸åŠ¨åœ°è¿”å›ã€‚

&emsp;`Promise.reject(reason)` æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸º rejectedã€‚`Promise.reject` æ–¹æ³•çš„å‚æ•° `reason`ï¼Œä¼šè¢«ä¼ é€’ç»™å®ä¾‹çš„å›è°ƒå‡½æ•°ã€‚

```c++
var p = Promise.reject('å‡ºé”™äº†');
 
p.then(null, function (s){
  console.log(s)
});
// å‡ºé”™äº†
```

&emsp;ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ª Promise å¯¹è±¡çš„å®ä¾‹ï¼ŒçŠ¶æ€ä¸º rejectedï¼Œå›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚

&emsp;ä»¥ä¸Šå°±æ˜¯ Promise å¯¹è±¡å’Œä½¿ç”¨çš„ä¸€äº›æ€»ç»“ã€‚

## å‚è€ƒé“¾æ¥
**å‚è€ƒé“¾æ¥:ğŸ”—**
+ [Promise å¯¹è±¡](https://wohugb.gitbooks.io/ecmascript-6/content/docs/promise.html)
+ [Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)
+ [ECMAScript 6ç®€ä»‹](https://wohugb.gitbooks.io/ecmascript-6/content/docs/intro.html)
+ [JavaScript æ•™ç¨‹](https://wangdoc.com/javascript/)
+ [JavaScript å¼‚æ­¥ç¼–ç¨‹](https://www.runoob.com/js/js-async.html)
+ [JavaScript Promise å¯¹è±¡](https://www.runoob.com/w3cnote/javascript-promise-object.html)
+ [JSON æ•™ç¨‹](https://www.runoob.com/json/json-tutorial.html)
+ [JavaScript JSON](https://www.runoob.com/js/js-json.html)
